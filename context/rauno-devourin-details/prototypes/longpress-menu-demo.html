<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Long Press Menu - Interactive Demo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            width: 100%;
            background: white;
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .demo-info {
            margin-bottom: 40px;
        }

        .demo-info h1 {
            font-size: 2em;
            margin-bottom: 12px;
            color: #333;
        }

        .demo-info p {
            color: #666;
            line-height: 1.6;
            margin-bottom: 8px;
        }

        .instructions {
            background: #f0f7ff;
            border-left: 4px solid #0066cc;
            padding: 16px;
            border-radius: 6px;
            margin-bottom: 30px;
        }

        .instructions h3 {
            margin-bottom: 8px;
            color: #0066cc;
        }

        .instructions ul {
            margin-left: 20px;
            color: #555;
        }

        .instructions li {
            margin-bottom: 4px;
        }

        .target-area {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .target-item {
            background: #f8f9fa;
            border: 2px solid #e5e5e5;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            user-select: none;
            -webkit-user-select: none;
            transition: all 0.2s;
            position: relative;
            touch-action: none;
        }

        .target-item:hover {
            border-color: #0066cc;
            background: #f0f7ff;
        }

        .target-item:active {
            transform: scale(0.98);
        }

        .target-item.pressing {
            border-color: #0066cc;
            background: #e6f2ff;
            transform: scale(0.95);
        }

        .target-item h3 {
            margin-bottom: 8px;
            color: #333;
        }

        .target-item p {
            color: #666;
            font-size: 0.9em;
        }

        .press-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60px;
            height: 60px;
            border: 3px solid #0066cc;
            border-radius: 50%;
            opacity: 0;
            pointer-events: none;
        }

        .press-indicator.active {
            opacity: 1;
            animation: pulse 0.6s ease-out;
        }

        @keyframes pulse {
            0% {
                transform: translate(-50%, -50%) scale(0.8);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(1.2);
                opacity: 0;
            }
        }

        .progress-ring {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60px;
            height: 60px;
            pointer-events: none;
        }

        .progress-ring circle {
            fill: none;
            stroke: #0066cc;
            stroke-width: 3;
            stroke-linecap: round;
            stroke-dasharray: 157;
            stroke-dashoffset: 157;
            transition: stroke-dashoffset 0.1s linear;
        }

        .menu {
            position: fixed;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            padding: 8px;
            min-width: 200px;
            opacity: 0;
            transform: scale(0.9) translateY(-10px);
            pointer-events: none;
            z-index: 1000;
            border: 1px solid #e5e5e5;
        }

        .menu.visible {
            opacity: 1;
            transform: scale(1) translateY(0);
            pointer-events: all;
        }

        .menu-item {
            padding: 12px 16px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            color: #333;
            transition: background-color 0.15s;
            opacity: 0;
            transform: translateY(-5px);
        }

        .menu-item.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .menu-item:hover {
            background: #f0f7ff;
        }

        .menu-item:active {
            background: #e6f2ff;
        }

        .menu-item-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .menu-item-label {
            flex: 1;
            font-size: 14px;
        }

        .menu-divider {
            height: 1px;
            background: #e5e5e5;
            margin: 4px 0;
        }

        .principles-list {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-top: 30px;
        }

        .principles-list h3 {
            margin-bottom: 12px;
            color: #333;
        }

        .principles-list ul {
            list-style: none;
            margin-left: 0;
        }

        .principles-list li {
            padding: 8px 0;
            color: #555;
            border-bottom: 1px solid #e5e5e5;
        }

        .principles-list li:last-child {
            border-bottom: none;
        }

        .principles-list li strong {
            color: #0066cc;
        }

        .backdrop {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.3);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
            z-index: 999;
        }

        .backdrop.visible {
            opacity: 1;
            pointer-events: all;
        }
    </style>
</head>
<body>
    <div class="backdrop" id="backdrop"></div>
    
    <div class="container">
        <div class="demo-info">
            <h1>Long Press Menu</h1>
            <p>An interactive demo demonstrating Devouring Details principles applied to a long press menu interaction.</p>
        </div>

        <div class="instructions">
            <h3>Try it out!</h3>
            <ul>
                <li>Long press (hold for 600ms) on any card below</li>
                <li>Watch the progress ring fill up</li>
                <li>Menu appears with staggered animation</li>
                <li>Click outside or press Escape to close</li>
                <li>Notice the spring animation and visual feedback</li>
            </ul>
        </div>

        <div class="target-area">
            <div class="target-item" data-item="1">
                <div class="press-indicator" id="indicator-1"></div>
                <div class="progress-ring" id="progress-1">
                    <svg width="60" height="60">
                        <circle cx="30" cy="30" r="25" id="circle-1"></circle>
                    </svg>
                </div>
                <h3>Card 1</h3>
                <p>Long press me</p>
            </div>

            <div class="target-item" data-item="2">
                <div class="press-indicator" id="indicator-2"></div>
                <div class="progress-ring" id="progress-2">
                    <svg width="60" height="60">
                        <circle cx="30" cy="30" r="25" id="circle-2"></circle>
                    </svg>
                </div>
                <h3>Card 2</h3>
                <p>Long press me</p>
            </div>

            <div class="target-item" data-item="3">
                <div class="press-indicator" id="indicator-3"></div>
                <div class="progress-ring" id="progress-3">
                    <svg width="60" height="60">
                        <circle cx="30" cy="30" r="25" id="circle-3"></circle>
                    </svg>
                </div>
                <h3>Card 3</h3>
                <p>Long press me</p>
            </div>
        </div>

        <div class="principles-list">
            <h3>Principles Demonstrated</h3>
            <ul>
                <li><strong>Contained Gestures:</strong> Touch-action disabled, prevent context menu</li>
                <li><strong>Simulating Physics:</strong> Spring animation on menu appearance</li>
                <li><strong>Motion Choreography:</strong> Staggered menu items (100ms delay each)</li>
                <li><strong>Ergonomic Interactions:</strong> Visual feedback (progress ring, press indicator)</li>
                <li><strong>Responsive Interfaces:</strong> Instant feedback, clear state changes</li>
                <li><strong>Inferring Intent:</strong> Long press detection with visual progress</li>
            </ul>
        </div>
    </div>

    <div class="menu" id="menu">
        <div class="menu-item" data-action="edit">
            <div class="menu-item-icon">‚úèÔ∏è</div>
            <div class="menu-item-label">Edit</div>
        </div>
        <div class="menu-item" data-action="share">
            <div class="menu-item-icon">üîó</div>
            <div class="menu-item-label">Share</div>
        </div>
        <div class="menu-item" data-action="duplicate">
            <div class="menu-item-icon">üìã</div>
            <div class="menu-item-label">Duplicate</div>
        </div>
        <div class="menu-divider"></div>
        <div class="menu-item" data-action="delete">
            <div class="menu-item-icon">üóëÔ∏è</div>
            <div class="menu-item-label">Delete</div>
        </div>
    </div>

    <script>
        const LONG_PRESS_DURATION = 600; // ms
        const STAGGER_DELAY = 100; // ms between menu items

        const menu = document.getElementById('menu');
        const backdrop = document.getElementById('backdrop');
        const targetItems = document.querySelectorAll('.target-item');
        const menuItems = document.querySelectorAll('.menu-item');

        let pressTimer = null;
        let pressStartTime = 0;
        let currentTarget = null;
        let isPressing = false;
        let animationFrame = null;

        // Spring animation helper
        function springAnimation(start, target, onUpdate, onComplete) {
            const stiffness = 400;
            const damping = 25;
            let position = start;
            let velocity = 0;
            const targetValue = target;

            function animate() {
                const force = (targetValue - position) * (stiffness / 1000);
                velocity += force;
                velocity *= (1 - damping / 100);
                position += velocity;

                if (Math.abs(targetValue - position) < 0.5 && Math.abs(velocity) < 0.1) {
                    position = targetValue;
                    onUpdate(position);
                    if (onComplete) onComplete();
                    return;
                }

                onUpdate(position);
                animationFrame = requestAnimationFrame(animate);
            }

            animate();
        }

        function updateProgressRing(item, progress) {
            const circle = item.querySelector('circle');
            const circumference = 2 * Math.PI * 25; // radius = 25
            const offset = circumference - (progress * circumference);
            circle.style.strokeDashoffset = offset;
        }

        function showMenu(x, y, targetItem) {
            // Position menu
            const menuRect = menu.getBoundingClientRect();
            const viewportWidth = window.innerWidth;
            const viewportHeight = window.innerHeight;

            // Adjust position to stay in viewport
            let menuX = x;
            let menuY = y - 10; // Offset above cursor

            if (menuX + menuRect.width > viewportWidth) {
                menuX = viewportWidth - menuRect.width - 10;
            }
            if (menuX < 10) {
                menuX = 10;
            }
            if (menuY + menuRect.height > viewportHeight) {
                menuY = viewportHeight - menuRect.height - 10;
            }
            if (menuY < 10) {
                menuY = 10;
            }

            menu.style.left = menuX + 'px';
            menu.style.top = menuY + 'px';

            // Show menu with spring animation
            menu.classList.add('visible');
            backdrop.classList.add('visible');

            // Stagger menu items
            menuItems.forEach((item, index) => {
                setTimeout(() => {
                    item.classList.add('visible');
                }, index * STAGGER_DELAY);
            });
        }

        function hideMenu() {
            menu.classList.remove('visible');
            backdrop.classList.remove('visible');
            
            // Reset menu items
            menuItems.forEach(item => {
                item.classList.remove('visible');
            });
        }

        function handlePointerDown(e, item) {
            // Prevent context menu
            e.preventDefault();
            
            // Contained gesture setup
            item.style.touchAction = 'none';
            item.setPointerCapture(e.pointerId);

            isPressing = true;
            currentTarget = item;
            pressStartTime = Date.now();

            item.classList.add('pressing');
            const indicator = item.querySelector('.press-indicator');
            indicator.classList.add('active');

            // Start progress animation
            const startTime = Date.now();
            function updateProgress() {
                if (!isPressing || currentTarget !== item) return;

                const elapsed = Date.now() - startTime;
                const progress = Math.min(elapsed / LONG_PRESS_DURATION, 1);
                
                updateProgressRing(item, progress);

                if (progress >= 1) {
                    // Long press completed
                    const rect = item.getBoundingClientRect();
                    showMenu(rect.left + rect.width / 2, rect.top + rect.height / 2, item);
                    resetPress(item);
                    return;
                }

                requestAnimationFrame(updateProgress);
            }
            updateProgress();

            function handlePointerMove(e) {
                // If moved too far, cancel
                const rect = item.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;
                const distance = Math.sqrt(
                    Math.pow(e.clientX - centerX, 2) + 
                    Math.pow(e.clientY - centerY, 2)
                );

                if (distance > 50) {
                    resetPress(item);
                    item.releasePointerCapture(e.pointerId);
                    document.removeEventListener('pointermove', handlePointerMove);
                    document.removeEventListener('pointerup', handlePointerUp);
                }
            }

            function handlePointerUp(e) {
                resetPress(item);
                item.releasePointerCapture(e.pointerId);
                document.removeEventListener('pointermove', handlePointerMove);
                document.removeEventListener('pointerup', handlePointerUp);
            }

            document.addEventListener('pointermove', handlePointerMove);
            document.addEventListener('pointerup', handlePointerUp);
        }

        function resetPress(item) {
            isPressing = false;
            item.classList.remove('pressing');
            const indicator = item.querySelector('.press-indicator');
            indicator.classList.remove('active');
            updateProgressRing(item, 0);
            currentTarget = null;
        }

        // Attach handlers
        targetItems.forEach(item => {
            item.addEventListener('pointerdown', (e) => handlePointerDown(e, item));
            item.addEventListener('contextmenu', (e) => e.preventDefault());
        });

        // Menu item handlers
        menuItems.forEach(item => {
            item.addEventListener('click', (e) => {
                const action = item.dataset.action;
                alert(`Action: ${action}`);
                hideMenu();
            });
        });

        // Close menu on backdrop click
        backdrop.addEventListener('click', hideMenu);

        // Close menu on Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && menu.classList.contains('visible')) {
                hideMenu();
            }
        });

        // Close menu on scroll (optional)
        let scrollTimeout;
        window.addEventListener('scroll', () => {
            if (menu.classList.contains('visible')) {
                clearTimeout(scrollTimeout);
                scrollTimeout = setTimeout(() => {
                    hideMenu();
                }, 100);
            }
        });
    </script>
</body>
</html>

